## 柚子问卷问题汇总（07.17 - 07.25）

### 1.颜色值十六进制进制转为RGB
    
	// 16进制颜色转为RGB格式
	function colorRgb (sColor) {
	  var reg = /^#([0-9a-fA-f]{3}|[0-9a-fA-f]{6})$/;
	  sColor = sColor && sColor.toLowerCase();
	  if (sColor && reg.test(sColor)) {
	    if (sColor.length === 4) {
	      var sColorNew = '#';
	      for (var i = 1; i < 4; i++) {
	        sColorNew += sColor.slice(i, i + 1).concat(sColor.slice(i, i + 1));
	      }
	      sColor = sColorNew;
	    }
	    // 处理六位的颜色值
	    var sColorChange = [];
	    for (var i = 1; i < 7; i += 2) {
	      sColorChange.push(parseInt(sColor.slice(i, i + 2), 16));
	    }
	    // return 'RGB(' + sColorChange.join(',') + ')';
	    return {
	      r: sColorChange[0],
	      g: sColorChange[1],
	      b: sColorChange[2]
	    };
	  } else {
	    return sColor;
	  }
	}

### 2.边框1px问题

使用after和before伪元素来模拟边框1px，还可以实现圆角。
	
	// one-pixel-border
	<!DOCTYPE html>
	<html>
	<head>
		<title>one pixel border</title>
		<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maxium-scale=1">
		<style>
			.one-border {
				width: 100px;
				height: 100px;
				-webkit-box-sizing: border-box;
				box-sizing: border-box;
				position: relative;
			}
			.two {
				margin-top: 20px;
				border: 1px solid #000;
			}
			.one:after {
				content: '';
				position: absolute;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				border: 1px solid #000;
			}
			@media (-webkit-min-device-pixel-ratio: 1.5), (min-device-pixel-ratio: 1.5) {
			  /*四边边框*/
			  .one:after {
			    -webkit-transform-origin:0 0;
			    transform-origin:0 0;
			    -webkit-transform:scale(.5);
			    transform:scale(.5);
			    width: 200%;
			    height: 200%;
				border-radius: 8px;
			  }
			}
	
			/* 解决1.5屏幕下某些边框不显式问题，小数位多写几位 */
			@media (-webkit-device-pixel-ratio: 1.5) {
			  /*四边框*/
			  .one:after{
			    -webkit-transform:scale(.6666);
			    transform:scale(.6666);
			    width: 150%;
			    height: 150%;
				border-radius: 6px;
			  }
			}
	
			@media (-webkit-device-pixel-ratio: 3) {
			  /*四边框*/
			  .one:after{
			    -webkit-transform:scale(.3333);
			    transform:scale(.3333);
			    width: 300%;
			    height: 300%;
			    border-radius: 12px;
			  }
			}
		</style>
	</head>
	<body>
		<div class="one-border one"></div>
		<div class="one-border two"></div>
	</body>
	</html>

参考链接：[http://www.topcss.org/one-device-pixel-border/](http://www.topcss.org/one-device-pixel-border/)

demo:[http://www.topcss.org/demo/one-device-pixel-border.html](http://www.topcss.org/demo/one-device-pixel-border.html "demo链接")

### 3.403 http错误

测试环境的nginx做了限制IP访问的限制，导致访问被拦截，报403。 

![403错误](http://i.imgur.com/cHPw2cA.png)

参考链接：[http://www.mahaixiang.cn/seoyjy/403.html](http://www.mahaixiang.cn/seoyjy/403.html "403错误参考链接")

### 4.android下svg图片展示问题

问题描述：在HTML里面直接引入`<img src="rect.svg" alt="">`Android下不支持，IOS正常。

SVG有三种方案可以嵌入HTML文档中：`<embed>`、`<object>`、`<iframe>`.

- `<embed>` 被所有主流浏览器支持，允许使用脚本。但是不符合XHTML。
	`<embed src="rect.svg" width="300" height="100" type="image/svg+xml" pluginspage="http://www.adobe.com/svg/viewer/install/" />`
- `<object>` HTML4标签，不允许使用脚本。
	`<object data="rect.svg" width="300" height="100" type="image/svg+xml" codebase="http://www.adobe.com/svg/viewer/install/" />`
- `<iframe>` 标签可工作在大部分的浏览器中。
	`<iframe src="rect.svg" width="300" height="100">`</iframe>

参考链接：[http://www.w3school.com.cn/svg/svg_inhtml.asp](http://www.w3school.com.cn/svg/svg_inhtml.asp)

目前也是可以在HTML直接内联SVG`<svg>`(IOS/Android都支持)，例如：

	<svg version="1.1" id="图层_1" x="0px" y="0px"
       viewBox="0 0 70 70" style="enable-background:new 0 0 70 70;width: 7rem;" xml:space="preserve">
      <style type="text/css">
        .st0{opacity:0.5;fill:#ff74b9;}
      </style>
      <path class="st0" d="M34,63.5C20.1,63.5,8.1,53,6.7,38.9c-0.8-7.3,1.4-14.5,6-20.2s11.2-9.3,18.5-10c8.2-0.9,16.2,1.9,22.1,7.7
        c0.6,0.6,0.6,1.5,0,2.1c-0.6,0.6-1.5,0.6-2.1,0c-5.2-5.1-12.4-7.6-19.7-6.8C18,13,8.2,25.1,9.6,38.6C11,52,23.1,61.8,36.6,60.4
        C50,59,59.8,46.9,58.4,33.4c-0.1-0.8,0.5-1.6,1.3-1.6c0.8-0.1,1.6,0.5,1.6,1.3c1.6,15.1-9.4,28.6-24.5,30.2
        C35.9,63.5,34.9,63.5,34,63.5z"/>
      <path class="st0" d="M33.1,49.1c-0.4,0-0.8-0.1-1.1-0.4L17.9,34.5c-0.6-0.6-0.6-1.5,0-2.1s1.5-0.6,2.1,0l13.1,13.1L61,17.5
                  	c0.6-0.6,1.5-0.6,2.1,0c0.6,0.6,0.6,1.5,0,2.1l-29,29C33.8,48.9,33.5,49.1,33.1,49.1z"/>
    </svg>

！！还有另外的一种写法：
`<svg width="96" height="96">
  <image xlink:href="svg.svg" src="svg.png" width="96" height="96" />
</svg>`
在不支持svg的时候会使用png（但是在Android还是不支持，直接使用png/jpg）。

### 5.input外层包一个div不对齐

可能是因为div写的的样式导致的。后面只在去掉div包着，直接对input进行样式处理。

### 6.input底部少了1px(filter)

问题描述：输入框需要在填了值之后给它加上有透明度的背景色。因为这个背景色是根据接口数据返回来设置，刚开始是直接使用`background-color`、`filter: opacity(0.9)`来设置。会造成在IOS下输入框会出现底部少了1px的问题。

后面直接用其他的方案：js计算背景色的RGB值，然后设置`background-color: rgba(r, g, b, 0.9)`.


### 7.Android下有些圆形变成椭圆形
在使用rem的情况下，边框的值可能会出现不适偶数或者整数的情况。
Android下边框值不为整数造成。

### 8.Android下标题丢失
jsBrodge.initListener 'topbar/title' 问题

### 9.输入框1px问题

折中方案：android下2px(设为1px),IOS下1px(设为0.5px)。

或者在input外层套一个div，然后使用after/before伪元素来实现边框1px。


### 10.Android下防止键盘把输入框挡住

问题描述：
使用 H5 做移动 App，或者进行移动网站开发时。如果文本输入框在整个页面的下方，当我们点击输入框要输入文字时，系统弹出的虚拟键盘就会将输入框给挡住。（这个只有在Android 系统下会有这个问题，iOS 系统会自动将整个页面上移动。）

	//防止键盘把当前输入框给挡住
	$$('input[type="text"],textarea').on('click', function () {
	  var target = this;
	  setTimeout(function(){
        target.scrollIntoViewIfNeeded();
        console.log('scrollIntoViewIfNeeded');
      },400); // 延迟400毫秒出现时有些 Android 手机键盘出现的比较慢
	});

参考链接：

1.[http://www.111cn.net/wy/html5/119945.htm](http://www.111cn.net/wy/html5/119945.htm "参考链接")

2.[https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoViewIfNeeded](https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoViewIfNeeded "MDN参考链接")


### 11.（单选题）多重关联问题

单选选项选择时，需要对关联题进行判断

	// 多重关联（递归）
	function releaseRelvance ($siblings) {
	  for (var i = 0, len = $siblings.length; i < len; i++) {
	    var $cur = $siblings.eq(i);
	    if ($cur.hasClass('active')) {
	      var id = $cur.removeClass('active').attr('data-relvance');
	      if (id) {
	        var $curSlide = $('[data-id=' + id + ']');
	        var relevanced = $curSlide.attr('data-relevanced');
	        var required = $curSlide.find('.block').attr('data-required');
	        $curSlide.css({
	          display: 'none'
	        }).removeClass('isCounter active');
	        metaData.counter -= 1;
	        if (required != 0 && error > 0) error -= 1;
	        // 该选项还有关联题
	        if (relevanced) {
	          return releaseRelvance($curSlide.find('.inline-check'));
	        }
	      }
	    }
	  }
	}



## swiper插件使用问题汇总

### 1.IOS下，使用上下翻页造成页面样式错乱。
![图片地址](http://i.imgur.com/0w4ySIu.png)

问题产生原因：
点上下翻页按钮跳输入框焦点的问题是 div.swiper-container/div.swiper-wrapper 出现了 scrollTop

解决方案：
把swiper 下面的input 和 select 都监听focus 事件，把scrollTop 重置为0，然后计算下当前聚焦的输入框所在的 slide 的 index，使用 swiper.slideTo 划过去。

	// 重置问卷的scrollTop
	function onResetScrollTop (e) {
	  var $this = $(e.currentTarget);
	  var target = this;
	  if (target.scrollIntoViewIfNeeded) {
	    setTimeout(() => {
	      target.scrollIntoViewIfNeeded();
	    }, 300);
	  }
	  var $slide = $this.parents('.swiper-slide');
	  swiper.slideTo($slide.index('.swiper-slide:not(:hidden)'), () => {
	    $('.swiper-container, .swiper-wrapper').scrollTop(0);
	  }); // 在定位到该输入框的当前页面之后重置scrollTop为0
	}

	$('body').on('focus', 'input, select, textarea', onResetScrollTop);

### 2.IOS下键盘出现内容被顶上去出现样式错乱。

问题描述：
因为键盘出现会把内容顶上去，这时候其实swpier是重新调整了高度，所以需要在初始化之后就要给他的父级或者body设定一个高度。

	$('body')
	    .css({
	      height: document.documentElement.clientHeight
	    })；

	{
	  position: fixed;
	  left: 0;
	  right: 0;
	  bottom: 0;
	}

	

柚子问卷项目回顾：
自身：
1.前期冒烟测试不够；
2.移动端的经验不够，遇到一些棘手的问题不能立马处理；

需求：
1.一些细节的交互前期没跟UI和产品确认清楚，只是按照一些自我觉得习惯性的操作来实现。再加上需求交互本身不是很明确，所以难免一些改来改去。