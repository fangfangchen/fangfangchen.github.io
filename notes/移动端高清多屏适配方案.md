## 移动端高清、多屏适配方案

### 图片问题

普通屏幕下：

同样下载了@2x的图片，造成资源浪费。
图片由于downsampling，会失去了一些锐利度(或是色差)。
所以最好的解决办法是：不同的dpr下，加载不同的尺寸的图片。

不管是通过css媒体查询，还是通过javascript条件判断都是可以的。

那么问题来了，这样的话，不就是要准备两套图片了嘛？(@1x 和@2x)

我想，做的好的公司，都会有这么一个图片服务器，通过url获取参数，然后可以控制图片质量，也可以将图片裁剪成不同的尺寸。

所以我们只需上传大图(@2x)，其余小图都交给图片服务器处理，我们只要负责拼接url即可。

如，这样一张原图：

`https://img.alicdn.com/tps/TB1AGMmIpXXXXafXpXXXXXXXXXX.jpg // 原图`

可以类似这样，进行图片裁剪：

// 200×200

`https://img.alicdn.com/tps/TB1AGMmIpXXXXafXpXXXXXXXXXX.jpg_200x200.jpg`

// 100×100

`https://img.alicdn.com/tps/TB1AGMmIpXXXXafXpXXXXXXXXXX.jpg_100x100.jpg`
(ps: 当然裁剪只是对原图的等比裁剪，得保证图片的清晰嘛~)

### 多屏适配布局问题

移动端布局，为了适配各种大屏手机，目前最好用的方案莫过于使用相对单位rem。

基于rem的原理，我们要做的就是: 针对不同手机屏幕尺寸和dpr动态的改变根节点html的font-size大小(基准值)。

这里我们提取了一个公式(rem表示基准值)

`rem = document.documentElement.clientWidth * dpr / 10`

说明：

- 乘以dpr，是因为页面有可能为了实现1px border页面会缩放(scale) 1/dpr 倍(如果没有，dpr=1),。
- 除以10，是为了取整，方便计算(理论上可以是任何值)

用less定义了个通用的方法：

// 例如: .px2rem(height, 80);

	.px2rem(@name, @px){
	    @{name}: @px / 75 * 1rem;
	}


### 字体大小问题

既然上面的方案会使得页面缩放(scale)，对于页面区块的宽高，我们可以依赖高清视觉稿，因为视觉稿本来就×2了，我们直接量就可以了，那么对于字体该如何处理呢？

对于字体缩放问题，设计师原本的要求是这样的：任何手机屏幕上字体大小都要统一，所以我们针对不同的分辨率(dpr不同)，会做如下处理：

	font-size: 16px;
	[data-dpr="2"] input {
	  font-size: 32px;
	}
(注意，字体不可以用rem，误差太大了，且不能满足任何屏幕下字体大小相同)

为了方便，我们也会用less写一个mixin：

	.px2px(@name, @px) {
		@{name}: round(@px / 2) *1px;

		[data-dpr="2"] & {
			@{name}: @px * 1px;
		}

		// for mx3
		[data-dpr="2.5"] & {
			@{name}: round(@px * 2.5 / 2) * 1px;
		}

		// for 小米3
		[data-dpr="2.75"] & {
			@{name}: round(@px * 2.75 / 2) * 1px;
		}

		[data-dpr="3"] & {
			@{name}: round(@px * 3 / 2) * 1px;
		}
		
		// for 三星note4
		[data-dpr="4"] & {
			@{name}: @px * 2px;
		}
	}
	
	// 例子：
	.px2px(font-size, 32);